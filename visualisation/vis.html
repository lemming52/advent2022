<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<!-- Create a div where the graph will take place -->
<div><div id="my_dataviz" style="display: flex;justify-content: center;"></div></div>


<script>

    function isMax(i, indices) {
        if (indices.includes(i)) {
            return true
        }
        return false
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    var data = JSON.parse(`[
	{"val":37434,"maxIndices":[0,0,0]},
	{"val":18307,"maxIndices":[0,1,0]},
	{"val":53641,"maxIndices":[1,0,2]},
	{"val":46579,"maxIndices":[0,3,2]},
	{"val":37447,"maxIndices":[4,3,2]},
	{"val":45967,"maxIndices":[5,3,2]},
	{"val":49211,"maxIndices":[3,6,2]},
	{"val":46492,"maxIndices":[3,6,2]},
	{"val":50498,"maxIndices":[6,8,2]},
	{"val":42938,"maxIndices":[6,8,2]},
	{"val":49149,"maxIndices":[6,8,2]},
	{"val":47563,"maxIndices":[6,8,2]},
	{"val":53619,"maxIndices":[8,12,2]},
	{"val":45892,"maxIndices":[8,12,2]},
	{"val":57499,"maxIndices":[12,2,14]},
	{"val":49758,"maxIndices":[12,2,14]},
	{"val":38337,"maxIndices":[12,2,14]},
	{"val":45061,"maxIndices":[12,2,14]},
	{"val":57399,"maxIndices":[2,18,14]},
	{"val":16336,"maxIndices":[2,18,14]},
	{"val":52925,"maxIndices":[2,18,14]},
	{"val":41084,"maxIndices":[2,18,14]},
	{"val":61840,"maxIndices":[18,14,22]},
	{"val":47530,"maxIndices":[18,14,22]},
	{"val":36103,"maxIndices":[18,14,22]},
	{"val":38231,"maxIndices":[18,14,22]},
	{"val":41280,"maxIndices":[18,14,22]},
	{"val":58959,"maxIndices":[14,27,22]},
	{"val":47645,"maxIndices":[14,27,22]},
	{"val":49996,"maxIndices":[14,27,22]},
	{"val":41496,"maxIndices":[14,27,22]},
	{"val":61565,"maxIndices":[27,31,22]},
	{"val":52901,"maxIndices":[27,31,22]},
	{"val":48500,"maxIndices":[27,31,22]},
	{"val":41396,"maxIndices":[27,31,22]},
	{"val":60366,"maxIndices":[35,31,22]},
	{"val":57084,"maxIndices":[35,31,22]},
	{"val":59852,"maxIndices":[35,31,22]},
	{"val":52733,"maxIndices":[35,31,22]},
	{"val":47027,"maxIndices":[35,31,22]},
	{"val":39251,"maxIndices":[35,31,22]},
	{"val":45064,"maxIndices":[35,31,22]},
	{"val":61916,"maxIndices":[31,22,42]},
	{"val":42391,"maxIndices":[31,22,42]},
	{"val":36957,"maxIndices":[31,22,42]},
	{"val":41439,"maxIndices":[31,22,42]},
	{"val":57432,"maxIndices":[31,22,42]},
	{"val":43715,"maxIndices":[31,22,42]},
	{"val":22043,"maxIndices":[31,22,42]},
	{"val":58199,"maxIndices":[31,22,42]},
	{"val":37393,"maxIndices":[31,22,42]},
	{"val":61083,"maxIndices":[31,22,42]},
	{"val":52483,"maxIndices":[31,22,42]},
	{"val":59670,"maxIndices":[31,22,42]},
	{"val":40493,"maxIndices":[31,22,42]},
	{"val":39589,"maxIndices":[31,22,42]},
	{"val":46482,"maxIndices":[31,22,42]},
	{"val":40576,"maxIndices":[31,22,42]},
	{"val":38270,"maxIndices":[31,22,42]},
	{"val":54672,"maxIndices":[31,22,42]},
	{"val":41730,"maxIndices":[31,22,42]},
	{"val":57825,"maxIndices":[31,22,42]},
	{"val":56383,"maxIndices":[31,22,42]},
	{"val":46612,"maxIndices":[31,22,42]},
	{"val":63080,"maxIndices":[22,42,64]},
	{"val":50017,"maxIndices":[22,42,64]},
	{"val":40927,"maxIndices":[22,42,64]},
	{"val":49989,"maxIndices":[22,42,64]},
	{"val":51109,"maxIndices":[22,42,64]},
	{"val":50325,"maxIndices":[22,42,64]},
	{"val":51072,"maxIndices":[22,42,64]},
	{"val":45410,"maxIndices":[22,42,64]},
	{"val":62588,"maxIndices":[42,72,64]},
	{"val":40408,"maxIndices":[42,72,64]},
	{"val":48975,"maxIndices":[42,72,64]},
	{"val":56720,"maxIndices":[42,72,64]},
	{"val":39918,"maxIndices":[42,72,64]},
	{"val":52834,"maxIndices":[42,72,64]},
	{"val":60466,"maxIndices":[42,72,64]},
	{"val":42935,"maxIndices":[42,72,64]},
	{"val":47877,"maxIndices":[42,72,64]},
	{"val":58864,"maxIndices":[42,72,64]},
	{"val":66339,"maxIndices":[72,64,82]},
	{"val":58661,"maxIndices":[72,64,82]},
	{"val":53848,"maxIndices":[72,64,82]},
	{"val":59770,"maxIndices":[72,64,82]},
	{"val":53971,"maxIndices":[72,64,82]},
	{"val":47092,"maxIndices":[72,64,82]},
	{"val":50631,"maxIndices":[72,64,82]},
	{"val":57738,"maxIndices":[72,64,82]},
	{"val":35699,"maxIndices":[72,64,82]},
	{"val":46862,"maxIndices":[72,64,82]},
	{"val":51101,"maxIndices":[72,64,82]},
	{"val":52742,"maxIndices":[72,64,82]},
	{"val":53769,"maxIndices":[72,64,82]},
	{"val":65493,"maxIndices":[64,95,82]},
	{"val":52004,"maxIndices":[64,95,82]},
	{"val":58179,"maxIndices":[64,95,82]},
	{"val":40658,"maxIndices":[64,95,82]},
	{"val":42682,"maxIndices":[64,95,82]},
	{"val":43737,"maxIndices":[64,95,82]},
	{"val":53654,"maxIndices":[64,95,82]},
	{"val":42564,"maxIndices":[64,95,82]},
	{"val":50846,"maxIndices":[64,95,82]},
	{"val":64059,"maxIndices":[104,95,82]},
	{"val":39032,"maxIndices":[104,95,82]},
	{"val":35714,"maxIndices":[104,95,82]},
	{"val":31569,"maxIndices":[104,95,82]},
	{"val":62073,"maxIndices":[104,95,82]},
	{"val":57306,"maxIndices":[104,95,82]},
	{"val":62600,"maxIndices":[104,95,82]},
	{"val":44348,"maxIndices":[104,95,82]},
	{"val":44296,"maxIndices":[104,95,82]},
	{"val":53351,"maxIndices":[104,95,82]},
	{"val":55681,"maxIndices":[104,95,82]},
	{"val":52441,"maxIndices":[104,95,82]},
	{"val":34202,"maxIndices":[104,95,82]},
	{"val":49602,"maxIndices":[104,95,82]},
	{"val":51700,"maxIndices":[104,95,82]},
	{"val":53334,"maxIndices":[104,95,82]},
	{"val":56469,"maxIndices":[104,95,82]},
	{"val":41009,"maxIndices":[104,95,82]},
	{"val":63747,"maxIndices":[104,95,82]},
	{"val":48137,"maxIndices":[104,95,82]},
	{"val":53217,"maxIndices":[104,95,82]},
	{"val":55135,"maxIndices":[104,95,82]},
	{"val":50371,"maxIndices":[104,95,82]},
	{"val":52136,"maxIndices":[104,95,82]},
	{"val":44595,"maxIndices":[104,95,82]},
	{"val":47130,"maxIndices":[104,95,82]},
	{"val":46487,"maxIndices":[104,95,82]},
	{"val":54371,"maxIndices":[104,95,82]},
	{"val":32749,"maxIndices":[104,95,82]},
	{"val":62024,"maxIndices":[104,95,82]},
	{"val":35456,"maxIndices":[104,95,82]},
	{"val":29635,"maxIndices":[104,95,82]},
	{"val":33182,"maxIndices":[104,95,82]},
	{"val":46284,"maxIndices":[104,95,82]},
	{"val":46941,"maxIndices":[104,95,82]},
	{"val":55370,"maxIndices":[104,95,82]},
	{"val":45339,"maxIndices":[104,95,82]},
	{"val":56191,"maxIndices":[104,95,82]},
	{"val":45000,"maxIndices":[104,95,82]},
	{"val":41300,"maxIndices":[104,95,82]},
	{"val":42766,"maxIndices":[104,95,82]},
	{"val":34486,"maxIndices":[104,95,82]},
	{"val":45080,"maxIndices":[104,95,82]},
	{"val":44328,"maxIndices":[104,95,82]},
	{"val":32813,"maxIndices":[104,95,82]},
	{"val":57308,"maxIndices":[104,95,82]},
	{"val":47019,"maxIndices":[104,95,82]},
	{"val":55076,"maxIndices":[104,95,82]},
	{"val":46397,"maxIndices":[104,95,82]},
	{"val":46754,"maxIndices":[104,95,82]},
	{"val":32449,"maxIndices":[104,95,82]},
	{"val":46183,"maxIndices":[104,95,82]},
	{"val":59556,"maxIndices":[104,95,82]},
	{"val":54128,"maxIndices":[104,95,82]},
	{"val":53697,"maxIndices":[104,95,82]},
	{"val":52991,"maxIndices":[104,95,82]},
	{"val":36944,"maxIndices":[104,95,82]},
	{"val":34023,"maxIndices":[104,95,82]},
	{"val":46417,"maxIndices":[104,95,82]},
	{"val":46131,"maxIndices":[104,95,82]},
	{"val":55657,"maxIndices":[104,95,82]},
	{"val":52533,"maxIndices":[104,95,82]},
	{"val":57728,"maxIndices":[104,95,82]},
	{"val":46294,"maxIndices":[104,95,82]},
	{"val":30590,"maxIndices":[104,95,82]},
	{"val":46080,"maxIndices":[104,95,82]},
	{"val":50483,"maxIndices":[104,95,82]},
	{"val":51297,"maxIndices":[104,95,82]},
	{"val":16938,"maxIndices":[104,95,82]},
	{"val":57719,"maxIndices":[104,95,82]},
	{"val":41647,"maxIndices":[104,95,82]},
	{"val":43610,"maxIndices":[104,95,82]},
	{"val":49930,"maxIndices":[104,95,82]},
	{"val":40367,"maxIndices":[104,95,82]},
	{"val":57523,"maxIndices":[104,95,82]},
	{"val":66719,"maxIndices":[95,82,179]},
	{"val":51096,"maxIndices":[95,82,179]},
	{"val":63498,"maxIndices":[95,82,179]},
	{"val":48713,"maxIndices":[95,82,179]},
	{"val":50803,"maxIndices":[95,82,179]},
	{"val":42778,"maxIndices":[95,82,179]},
	{"val":63121,"maxIndices":[95,82,179]},
	{"val":43925,"maxIndices":[95,82,179]},
	{"val":53182,"maxIndices":[95,82,179]},
	{"val":49077,"maxIndices":[95,82,179]},
	{"val":11271,"maxIndices":[95,82,179]},
	{"val":30598,"maxIndices":[95,82,179]},
	{"val":39333,"maxIndices":[95,82,179]},
	{"val":36037,"maxIndices":[95,82,179]},
	{"val":46262,"maxIndices":[95,82,179]},
	{"val":47707,"maxIndices":[95,82,179]},
	{"val":37112,"maxIndices":[95,82,179]},
	{"val":50802,"maxIndices":[95,82,179]},
	{"val":44484,"maxIndices":[95,82,179]},
	{"val":22808,"maxIndices":[95,82,179]},
	{"val":49356,"maxIndices":[95,82,179]},
	{"val":35180,"maxIndices":[95,82,179]},
	{"val":49734,"maxIndices":[95,82,179]},
	{"val":53839,"maxIndices":[95,82,179]},
	{"val":43341,"maxIndices":[95,82,179]},
	{"val":56864,"maxIndices":[95,82,179]},
	{"val":50664,"maxIndices":[95,82,179]},
	{"val":48598,"maxIndices":[95,82,179]},
	{"val":37434,"maxIndices":[95,82,179]},
	{"val":46617,"maxIndices":[95,82,179]},
	{"val":8542,"maxIndices":[95,82,179]},
	{"val":18050,"maxIndices":[95,82,179]},
	{"val":52174,"maxIndices":[95,82,179]},
	{"val":52802,"maxIndices":[95,82,179]},
	{"val":47220,"maxIndices":[95,82,179]},
	{"val":30115,"maxIndices":[95,82,179]},
	{"val":43673,"maxIndices":[95,82,179]},
	{"val":54677,"maxIndices":[95,82,179]},
	{"val":47561,"maxIndices":[95,82,179]},
	{"val":44489,"maxIndices":[95,82,179]},
	{"val":46189,"maxIndices":[95,82,179]},
	{"val":50003,"maxIndices":[95,82,179]},
	{"val":46591,"maxIndices":[95,82,179]},
	{"val":46938,"maxIndices":[95,82,179]},
	{"val":37031,"maxIndices":[95,82,179]},
	{"val":41950,"maxIndices":[95,82,179]},
	{"val":41185,"maxIndices":[95,82,179]},
	{"val":47111,"maxIndices":[95,82,179]},
	{"val":45076,"maxIndices":[95,82,179]},
	{"val":49894,"maxIndices":[95,82,179]},
	{"val":56343,"maxIndices":[95,82,179]},
	{"val":61466,"maxIndices":[95,82,179]},
	{"val":26315,"maxIndices":[95,82,179]},
	{"val":52600,"maxIndices":[95,82,179]},
	{"val":32329,"maxIndices":[95,82,179]},
	{"val":64482,"maxIndices":[95,82,179]},
	{"val":53570,"maxIndices":[95,82,179]},
	{"val":53859,"maxIndices":[95,82,179]},
	{"val":45802,"maxIndices":[95,82,179]},
	{"val":22299,"maxIndices":[95,82,179]},
	{"val":47879,"maxIndices":[95,82,179]},
	{"val":55350,"maxIndices":[95,82,179]},
	{"val":55797,"maxIndices":[95,82,179]},
	{"val":42975,"maxIndices":[95,82,179]},
	{"val":51869,"maxIndices":[95,82,179]},
	{"val":43929,"maxIndices":[95,82,179]},
	{"val":47984,"maxIndices":[95,82,179]}
]`)


    // set the dimensions and margins of the graph
    var margin = {top: 10, right: 30, bottom: 90, left: 40},
        width = 460 - margin.left - margin.right,
        height = 450 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

    // X axis
    var x = d3.scaleBand()
      .range([ 0, width ])
      .domain(data.map(function(d) { return d.val; }))
      .padding(0.05);
    svg.append("g")
      .attr("transform", "translate(0," + height + ")")

    // Add Y axis
    var y = d3.scaleLinear()
      .domain([0, 75000])
      .range([ height, 0]);
    svg.append("g")
      .call(d3.axisLeft(y));

    svg.selectAll("mybar")
      .data(data)
      .enter()
      .append("rect")
        .attr("x", function(d) { return x(d.val); })
        .attr("width", x.bandwidth())
        .attr("fill", "#69b3a2")
        // no bar at the beginning thus:
        .attr("height", function(d) { return height - y(0); }) // always equal to 0
        .attr("y", function(d) { return y(0); })


    console.log(data)
    var currentMax = data[0].maxIndices
    for (i = 0; i < data.length; i++) {
        console.log(i)
        setTimeout(function(i) {
            d = data[i]
            var color = "#dce4ef"
            if (isMax(i, d.maxIndices)) {
                color = "#c62d1f"
            }
            d3.select(svg.selectAll("rect").nodes()[i])
                .style("fill", color)
                .transition()
                .duration(200)
                .attr("y", function(d) { return y(d.val); })
                .attr("height", function(d) { return height - y(d.val); })
            var removed = currentMax.filter(function(i) {
                return this.indexOf(i) < 0;
            }, d.maxIndices)
            if (removed.length != 0) {
                d3.select(svg.selectAll("rect").nodes()[removed[0]])
                    .style("fill", "#dce4ef")
            }
            currentMax = d.maxIndices
        }, 3000/data.length * i, i)
    }

    /*
    // Bars


    // Animation
    var bars = svg.selectAll("rect")
    bars.each(function(d, i) {
        var r = d3.select(this)
        console.log(isMax(i, data[i].maxIndices), i, data[i].maxIndices)
        if (isMax(i, data[i].maxIndices)) {
            r.attr("fill", "#ff0000")
        }
        r.transition()
        .duration(800)
        .attr("y", function(d) { return y(d.val); })
        .attr("height", function(d) { return height - y(d.val); })
        sleep(5000/data.length).then()
    })

    // Bars
svg.selectAll("mybar")
  .data(data)
  .enter()
  .append("rect")
    .attr("x", function(d) { return x(d.Country); })
    .attr("width", x.bandwidth())
    .attr("fill", "#69b3a2")
    // no bar at the beginning thus:
    .attr("height", function(d) { return height - y(0); }) // always equal to 0
    .attr("y", function(d) { return y(0); })

// Animation


*/
</script>